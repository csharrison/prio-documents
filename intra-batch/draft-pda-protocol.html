<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Private Data Aggregation Protocol</title>
<meta content="Some People" name="author">
<meta content="
       TODO: writeme 
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="draft-pda-protocol-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.9.5
    appdirs 1.4.4
    ConfigArgParse 1.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.0
    PyYAML 5.4.1
    requests 2.25.1
    setuptools 52.0.0
    six 1.15.0
-->
<link href="draft-pda-protocol.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  scrollbar-color: #bbb #eee;
}
@media (prefers-color-scheme: dark) {
html {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
#title, #rfcnum {
  margin: 1.5em 0 0.2em;
}
#rfcnum + #title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 500px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>

</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Private Data Aggregation Protocol</td>
<td class="right">July 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">People</td>
<td class="center">Expires 27 January 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">HTTPBIS</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-pda-protocol-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-07-26" class="published">26 July 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-01-27">27 January 2022</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. People</div>
<div class="org">Somewhere</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Private Data Aggregation Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">TODO: writeme<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    mailing list (),
  which is archived at <span><a href=""></a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/abetterinternet/prio-documents">https://github.com/abetterinternet/prio-documents</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 27 January 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact ulEmpty toc ulBare">
<li class="compact ulEmpty toc ulBare" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-disclaimer" class="xref">DISCLAIMER</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-overview" class="xref">Overview</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-private-aggregation-via-sec" class="xref">Private aggregation via secret sharing</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-validating-inputs-in-zero-k" class="xref">Validating inputs in zero knowledge</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-collecting-reports" class="xref">Collecting reports</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-data-flow" class="xref">Data flow</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-pda-protocols" class="xref">PDA protocols</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-configuration" class="xref">Configuration</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-tasks" class="xref">Tasks</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.  <a href="#name-hpke-key-configuration" class="xref">HPKE key configuration</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-pre-conditions" class="xref">Pre-conditions</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-upload" class="xref">Upload</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-key-config-request" class="xref">Key Config Request</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-upload-request" class="xref">Upload Request</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-collect" class="xref">Collect</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.4.2.1">
                    <p id="section-toc.1-1.3.2.4.2.1.1"><a href="#section-3.4.1" class="xref">3.4.1</a>.  <a href="#name-collect-request" class="xref">Collect Request</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.4.2.2">
                    <p id="section-toc.1-1.3.2.4.2.2.1"><a href="#section-3.4.2" class="xref">3.4.2</a>.  <a href="#name-verifying-and-aggregating-r" class="xref">Verifying and Aggregating Reports</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-error-handling" class="xref">Error handling</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-common-abort-conditions" class="xref">Common abort conditions</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-prio" class="xref">Prio</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-parameters" class="xref">Parameters</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-finite-field-arithmetic" class="xref">Finite field arithmetic</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-pseudorandom-number-generat" class="xref">Pseudorandom number generation</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-hits" class="xref">Hits</a></p>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-system-design" class="xref">System design</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-aggregator-discovery" class="xref">Aggregator discovery</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-share-uploading" class="xref">Share uploading</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-open-questions-and-system-p" class="xref">Open questions and system parameters</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-operational-considerations" class="xref">Operational Considerations</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-data-resolution-limitations" class="xref">Data resolution limitations</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-aggregation-utility-and-sof" class="xref">Aggregation utility and soft batch deadlines</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-data-integrity-constraints" class="xref">Data integrity constraints</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-security-overview" class="xref">Security overview</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="xref">8.1.1</a>.  <a href="#name-threat-model" class="xref">Threat model</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="xref">8.1.2</a>.  <a href="#name-future-work-and-possible-ex" class="xref">Future work and possible extensions</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="xref">8.1.3</a>.  <a href="#name-security-considerations-2" class="xref">Security considerations</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-system-requirements" class="xref">System requirements</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="xref">8.2.1</a>.  <a href="#name-data-types" class="xref">Data types</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact ulEmpty toc ulBare" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes a framework for specifying protocols for
privacy-preserving data-aggregation. Each protocol is executed by a large set of
clients and a small set of servers. The servers' goal is to compute some
aggregate statistic over the clients' inputs without learning the inputs
themselves. This is made possible by distributing the computation among the
servers in such a way that, as long as at least one of them executes the
protocol honestly, no input is ever seen in the clear by any server.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="disclaimer">
<section id="section-1.1">
        <h3 id="name-disclaimer">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-disclaimer" class="section-name selfRef">DISCLAIMER</a>
        </h3>
<p id="section-1.1-1">This document is a work in progress. We have not yet settled on the design of
the protocol framework or the set of features we intend to support.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">This section defines some terminology we will use in the remainder of this
document.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1.2-2">
<li id="section-1.2-2.1">Aggregation function: The function computed over the users' inputs.<a href="#section-1.2-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.2">Aggregator: An endpoint that runs the input-validation protocol and
accumulates input shares.<a href="#section-1.2-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.3">Batch: A set of reports that are aggregated into an output.<a href="#section-1.2-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.4">Batch size: The minimum size of a batch.<a href="#section-1.2-2.4" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.5">Batch window: The minimum time difference between the oldest and newest
report in a batch (in seconds).<a href="#section-1.2-2.5" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.6">Client: The endpoint from which a user sends data to be aggregated, e.g., a
web browser.<a href="#section-1.2-2.6" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.7">Collector: The endpoint that receives the output of the aggreagtion function.
It also specifies the parameters of the protocol.<a href="#section-1.2-2.7" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.8">False input: An input that is valid, but incorrect. For example, if the data
being gathered is whether or not users have clicked on a particular button, a
client could report clicks when none occurred.<a href="#section-1.2-2.8" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.9">Input: The measurement (or measurements) emitted by a client, before any
encryption or secret sharing scheme is applied.<a href="#section-1.2-2.9" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.10">Input share: one of the shares output by feeding an input into a secret
sharing scheme. Each share is to be transmitted to one of the participating
aggregators.<a href="#section-1.2-2.10" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.11">Input validation protocol: The protocol executed by the client and
aggregators in order to validate the client's input without leaking its value
to the aggregators.<a href="#section-1.2-2.11" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.12">Invalid input: An input for which the input validation protocol fails. For
example, if the input is meant to be a  bit vectors, then <code>[2, 1, 0]</code> is
invalid.<a href="#section-1.2-2.12" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.13">Measurement: A single value (e.g., a count) being reported by a client.
Multiple measurements may be grouped into a single protocol input.<a href="#section-1.2-2.13" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.14">Leader: A distinguished aggregator that coordinates input validation and data
collection.<a href="#section-1.2-2.14" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.15">Output: A reduction over the inputs, for instance a statistical aggregation,
which is of interest to a collector. This is the output of the aggregation
function.<a href="#section-1.2-2.15" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.16">Output share: The share of an output emitted by an aggregator. Output shares
can be reassembled by the leader into the final output.<a href="#section-1.2-2.16" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.17">Prio v1: Mozilla's <a href="https://blog.mozilla.org/security/2019/06/06/next-steps-in-privacy-preserving-telemetry-with-prio/">Origin Telemetry project</a>.<a href="#section-1.2-2.17" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.18">Prio v2: Contact tracing project by Apple, Google, and ISRG.<a href="#section-1.2-2.18" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.19">Proof: A value generated by the client used by the aggregators to verify the
client's input.<a href="#section-1.2-2.19" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.20">Proof share: A share of a proof, used by an aggregator during the
input-validation protocol.<a href="#section-1.2-2.20" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.21">Report: Uploaded to the leader from the client. A report contains the
secret-shared and encrypted input and proof.<a href="#section-1.2-2.21" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.22">Server: An aggregator or collector.<a href="#section-1.2-2.22" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-2-1">[OPEN ISSUE: Rework this section in light of issue #44.]<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The protocol is executed by a large set of clients and a small set of servers.
We call the servers the <em>aggregators</em>. Each client's input to the protocol is a
set of measurements (e.g., counts of some user behavior). Given the input set
of measurements <code>x_1, ..., x_n</code> held by <code>n</code> users, the goal of a
<em>private data aggregation (PDA) protocol</em> is to compute <code>y = F(x_1, ..., x_n)</code> for
some aggregation function <code>F</code> while revealing nothing else about the
measurements.<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="private-aggregation-via-secret-sharing">
<section id="section-2.1">
        <h3 id="name-private-aggregation-via-sec">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-private-aggregation-via-sec" class="section-name selfRef">Private aggregation via secret sharing</a>
        </h3>
<p id="section-2.1-1">The main cryptographic tool used for achieving this privacy goal is <em>additive
secret sharing</em>. Rather than send its input in the clear, each client splits
its measurements into a sequence of <em>shares</em> and sends a share to each of the
aggregators. Additive secret sharing has two important properties:
- It's impossible to deduce the measurement without knowing <em>all</em> of the shares.
- It allows the aggregators to compute the final output by first adding up their
  measurements shares locally, then combining the results to obtain the final
  output.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Consider an illustrative example. Suppose there are three clients and two
aggregators. Each client <code>i</code> holds a single measurement in the form of a
positive integer <code>x[i]</code>, and our goal is to compute the sum of the measurements
of all clients. In this case, the protocol input is a single measurement
consisting of a single positive integer; no additional encoding is done. Given
this input, the first client splits its measurement <code>x[1]</code> with additive
secret-sharing into a pair of integers <code>X[1,1]</code> and <code>X[1,2]</code> for which <code>x[1]</code> is
equal to <code>X[1,1] + X[1,2]</code> modulo a prime number <code>p</code>. (For convenience, we will
omit the mod <code>p</code> operator in the rest of this section.) It then uploads <code>X[1,1]</code>
to one server <code>X[1,2]</code> to the other. The second client splits its measurement
<code>x[2]</code> into <code>X[1,2]</code> and <code>X[2,2]</code>, uploads them to the servers, and so on.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">Now the first aggregator is in possession of shares <code>X[1,1]</code>, <code>X[2,1]</code>, and
<code>X[3,1]</code> and the second aggregator is in possession of shares <code>X[2,1]</code>,
<code>X[2,2]</code>, and <code>X[2,3]</code>. Each aggregator computes the sum of its shares; let
<code>A[1]</code> denote the first aggregator's share of the sum and let <code>A[2]</code> denote the
second aggregator's share of the sum. In the last step, aggregators combine
their sum shares to obtain the final output <code>y = A[1] + A[2]</code>. This is correct
because modular addition is commutative. I.e.,<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.1-4">
<pre>
    y = A[1] + A[2]
      = (x[1,1] + x[2,1] + x[3,1]) + (x[1,2] + x[2,2] + x[3,2])
      = (x[1,1] + x[1,2]) + (x[2,1] + x[2,2]) + (x[3,1] + x[3,2])
      = x[1] + x[2] + x[3]
      = F(x[1], x[2], x[3])
</pre><a href="#section-2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-2.1-5"><strong>Prio.</strong>
This approach can be used to privately compute any function <code>F</code> that can be
expressed as a function of the sum of the users' inputs. In Prio <span>[<a href="#CB17" class="xref">CB17</a>]</span>, each
user splits its input into shares and sends each share to one of the
aggregators. The aggregators sum up their input shares. Once all the shares have
been aggregated, they combine their shares of the aggregate to get the final
output.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">Not all aggregate functions can be expressed this way efficiently, however. Prio
supports only a limited set of aggregation functions, some of which we highlight
below:<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-7.1">Simple statistics, like sum, mean, min, max, variance, and standard deviation;<a href="#section-2.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.2">Histograms with fixed bin sizes (also allows estimation of quantiles, e.g.,
the median);<a href="#section-2.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.3">More advanced statistics, like linear regression;<a href="#section-2.1-7.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.4">Bitwise-OR and -AND on bit strings; and<a href="#section-2.1-7.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.5">Computation of data structures, like Bloom filters, counting Bloom filters,
and count-min sketches, that approximately represent (multi-)sets of strings.<a href="#section-2.1-7.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-8">This variety of aggregate types is sufficient to support a wide variety of
data aggregation tasks.<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<p id="section-2.1-9"><strong>Hits.</strong>
A common PDA task that can't be solved efficiently with Prio is the
<code>t</code>-<em>heavy-hitters</em> problem <span>[<a href="#BBCp21" class="xref">BBCp21</a>]</span>. In this setting, each user is in
possession of a single <code>n</code>-bit string, and the goal is to compute the compute
the set of strings that occur at least <code>t</code> times. One reason that Prio doesn't
apply to this problem is that the proof generated by the client would be huge.<a href="#section-2.1-9" class="pilcrow">¶</a></p>
<p id="section-2.1-10">[TODO: Provide an overview of the protocol of <span>[<a href="#BBCp21" class="xref">BBCp21</a>]</span> and provide some
intuition about how additive secret sharing is used.]<a href="#section-2.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validating-inputs-in-zero-knowledge">
<section id="section-2.2">
        <h3 id="name-validating-inputs-in-zero-k">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-validating-inputs-in-zero-k" class="section-name selfRef">Validating inputs in zero knowledge</a>
        </h3>
<p id="section-2.2-1">An essential task of any data collection pipeline is ensuring that the input
data is "valid". Going back to the example above, it's often useful to assert
that each measurement is in a certain range, e.g., <code>[0, 2^k)</code> for some <code>k</code>.
This straight-forward task is complicated in our setting by the fact that the
inputs are secret shared. In particular, a malicious client can corrupt the
computation by submitting random integers instead of a proper secret sharing of
a valid input.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">To solve this problem, in each PDA protocol, the client generates a
zero-knowledge proof of its input's validity that the aggregators use
to verify that their shares correspond to as valid input. The verification
procedure is designed to ensure that the aggregators learn nothing about the
input beyond its validity.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">After encoding its measurements as an input to the PDA protocol, the client
generates a <em>proof</em> of the input's validity. It then splits the proof into
shares and sends a share of both the proof and input to each aggregator. The
aggregators use their shares of the proof to decide if their input shares
correspond to a valid input.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collecting-reports">
<section id="section-2.3">
        <h3 id="name-collecting-reports">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-collecting-reports" class="section-name selfRef">Collecting reports</a>
        </h3>
<p id="section-2.3-1">As noted above, each client has a collection of measurements that it
wants to send. Each measurement is characterized by a set of
parameters that are centrally configured and provided to each client:<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-2.1">A unique identifier (e.g., "dns-queries-mean")<a href="#section-2.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-2.2">A description of how to collect the measurement (e.g., "count
the number of DNS queries")<a href="#section-2.3-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-2.3">The statistic to be computed over the measurement values (e.g., mean)<a href="#section-2.3-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-2.4">The rules for what constitutes a valid value (e.g., must be between 0
and 10000)<a href="#section-2.3-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.3-3">Once the client has collected the measurements to send, it needs to
turn them into a set of reports. Naively, each measurement would be
sent in its own report, but it is also possible to have multiple
measurements in a single report; clients need to be configured with
the mapping from measurements to reports. The set of measurements
that go into a report is referred to as the "input" to the report.
Because each report is independent, for the remainder of this document
we focus on a single report and its inputs.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">[NOTE(cjpatton): This paragraph is slightly misleading. If you want to do a
range check for the measurement (this will usually be necessary, IMO) then
you'll need a few extra field elements to encode the input.]
The client uses the statistic to be computed in order to know how to
encode the measurement. For instance, if the statistic is mean, then
the measurement can be encoded directly. However, if the statistic is
standard deviation, then the client must send both <code>x</code> and <code>x^2</code>. Section
[TODO: cite to internal description of how to encode]
describes how to encode measurements for each statistic.
The client uses the validity rules to construct the zero knowledge
proof showing that the encoded measurement is valid.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="data-flow">
<section id="section-2.4">
        <h3 id="name-data-flow">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-data-flow" class="section-name selfRef">Data flow</a>
        </h3>
<p id="section-2.4-1">Each PDA task consists of two sub-protocols, <em>upload</em> and <em>collect</em>, which are
executed concurrently. Each sub-protocol consists of a sequence of HTTP requests
made from one entity to another.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<span id="name-who-makes-requests-to-whom-"></span><div id="pa-topology">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-2.4-2.1">
<pre>
+-------------+ 1.      +-------------+
|             +---------&gt;             |
|   Client    |         |   Leader    |
|             |    +----+             |
+------+------+    | 2. +------^------+
       | 1.        |           |
       |           |           |
       |           |           | 2.
+------v------+    |    +------+------+
|             &lt;----+    |             |
|   Helper    |         |  Collector  |
|             |         |             |
+-------------+         +-------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-who-makes-requests-to-whom-" class="selfRef">Who makes requests to whom while executing a PDA task.</a>
          </figcaption></figure>
</div>
<ol start="1" type="1" class="normal type-1" id="section-2.4-3">
<li id="section-2.4-3.1">
            <strong>Upload:</strong> Each client assembles its measurements into an input for the
given PDA protocol. It generates a proof of its input's validity and splits
the input and proof into two shares, one for the leader and another for a
helper. The client then encrypts the leader's share and helper's share under,
respectively, the leader's public key and the helper's public key. (The keys
are obtained by making requests to the leader and helper.) Finally, the
client uploads the encrypted shares to the leader.<a href="#section-2.4-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-2.4-3.2">
            <strong>Collect:</strong> The collector makes one or more requests to the leader in order
to obtain the final output of the protocol. Before the output can be
computed, the aggregators (i.e, the leader and helper) need to have verified
and aggregated a sufficient number of inputs. Depending on the PDA protocol,
it may be possible for the aggregators to do so immediately when reports are
uploaded. (See <a href="#prio" class="xref">Section 4</a>.) However, in general it is necessary for them to
wait until (a) enough reports have been uploaded and (b) the collector has
made a request. (See <a href="#hits" class="xref">Section 5</a>.)<a href="#section-2.4-3.2" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="pa">
<section id="section-3">
      <h2 id="name-pda-protocols">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-pda-protocols" class="section-name selfRef">PDA protocols</a>
      </h2>
<p id="section-3-1">This section specifies a protocol for executing generic PDA tasks. Concrete
PDA protocols are described in <a href="#prio" class="xref">Section 4</a> and <a href="#hits" class="xref">Section 5</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">Each round of the protocol corresponds to an HTTP request and response. The
content type of each request is "application/octet-stream". We assume that some
transport layer security protocol (e.g., TLS or QUIC) is used between each pair
of parties and that the server is authenticated.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">[TODO: Decide how to provide mutual authentication in leader-to-helper and
collector-to-leader connections. One option is to use client certificates for
TLS; another is to have the leader sign its messages directly, as in Prio v2.
For collector-to-leader connections, we may just have this be up to deployment.
(For instance, the collector might authenticate themselves by logging into a
website that has some trust relationship with the leader.)]<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">[TODO: @chris-wood suggested we specify APIs for producing and consuming each of
the messages in the protocol. Specific PDA protocols would implement this API.]<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5"><strong>Error handling.</strong>
In this section, we will use the verbs "abort" and "alert with <code>[some error
message]</code>" to describe how protocol participants react to various error
conditions. The behavior is specified in <a href="#pa-error" class="xref">Section 3.5</a>. For common errors, we may
elide the verbs altogether and refer to <a href="#pa-error-common-aborts" class="xref">Section 3.6</a>.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">[TODO: Fix the bounds for length-prefixed parameters in protocol messages.
(E.g., <code>&lt;23..479&gt;</code> instead of <code>&lt;1..2^16-1&gt;</code>.)]<a href="#section-3-6" class="pilcrow">¶</a></p>
<div id="pa-config">
<section id="section-3.1">
        <h3 id="name-configuration">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-configuration" class="section-name selfRef">Configuration</a>
        </h3>
<div id="tasks">
<section id="section-3.1.1">
          <h4 id="name-tasks">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-tasks" class="section-name selfRef">Tasks</a>
          </h4>
<p id="section-3.1.1-1">Each PDA protocol is associated with a <em>PDA task</em> that specifies the measurements
that are to be collected. Associated to each task is a set of <em>PDA Parameters</em>,
encoded by the following <code>PDAParam</code> structure, which specify the protocol used to
verify and aggregate the clients' measurements:<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1.1-2">
<pre>
struct {
  opaque nonce[16];
  Url leader_url;
  Url helper_url;
  HpkeConfig collector_config; // [TODO: Remove this?]
  uint64 batch_size;
  Duration batch_window;
  PDAProto proto;
  uint16 length; // Length of the remainder.
  select (PDAClientParam.proto) {
    case prio: PrioParam;
    case hits: HitsParam;
  }
} PDAParam;

enum { prio(0), hits(1) } PDAProto;

opaque Url&lt;1..2^16-1&gt;;

Duration uint64; /* Number of seconds elapsed between two instants */

Time uint64; /* seconds elapsed since start of UNIX epoch */
</pre><a href="#section-3.1.1-2" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-3.1.1-3.1">
              <code>nonce</code>: A unique sequence of bytes used  to ensure that two otherwise
identical <code>PDAParam</code> instances will have distinct <code>PDATaskID</code>s. It is
RECOMMENDED that this be set to a random 16-byte string derived from a
cryptographically secure pseurandom number generator.<a href="#section-3.1.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.1.1-3.2">
              <code>leader_url</code>: The leader's endpoint URL.<a href="#section-3.1.1-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.1.1-3.3">
              <code>helper_url</code>: The helper's endpoint URL.<a href="#section-3.1.1-3.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.1.1-3.4">
              <code>collector_config</code>: The HPKE configuration of the collector (described in
<a href="#hpke-config" class="xref">Section 3.1.2</a>). [OPEN ISSUE: Maybe the collector's HPKE config should be
carried by the collect request?]<a href="#section-3.1.1-3.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.1.1-3.5">
              <code>batch_size</code>: The batch size, i.e., the minimum number of reports that are
aggregated into an output.<a href="#section-3.1.1-3.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.1.1-3.6">
              <code>batch_window</code>: The batch window, i.e., the minimum time difference between
the oldest and newest report in a batch.<a href="#section-3.1.1-3.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.1.1-3.7">
              <code>proto</code>: The PDA protocol, e.g., Prio or Hits. The rest of the structure
contains the protocol specific parameters.<a href="#section-3.1.1-3.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.1.1-4">Each task has a unique <em>task ID</em> derived from the PDA parameters:<a href="#section-3.1.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1.1-5">
<pre>
opaque PDATaskID[32];
</pre><a href="#section-3.1.1-5" class="pilcrow">¶</a>
</div>
<p id="section-3.1.1-6">The task ID of a <code>PDAParam</code> is derived using the following procedure:<a href="#section-3.1.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1.1-7">
<pre>
task_id = SHA-256(param)
</pre><a href="#section-3.1.1-7" class="pilcrow">¶</a>
</div>
<p id="section-3.1.1-8">Where <code>SHA-256</code> is as specified in <span>[<a href="#FIPS180-4" class="xref">FIPS180-4</a>]</span>.<a href="#section-3.1.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hpke-config">
<section id="section-3.1.2">
          <h4 id="name-hpke-key-configuration">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-hpke-key-configuration" class="section-name selfRef">HPKE key configuration</a>
          </h4>
<p id="section-3.1.2-1">Our protocol uses HPKE for public-key encryption <span>[<a href="#I-D.irtf-cfrg-hpke" class="xref">I-D.irtf-cfrg-hpke</a>]</span>. Each
aggregator specifies the HPKE public key that clients use to encrypt its input
share, and the collector specifies the HPKE public key that helpers use to
encrypt output shares during collection. The public key and associated
parameters are structured as follows:<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1.2-2">
<pre>
struct {
  uint8 id;
  HpkeKemId kem_id;
  HpkeKdfId kdf_id;
  HpkeAeadKdfId aead_id;
  HpkePublicKey public_key;
} HpkeConfig;

opaque HpkePublicKey&lt;1..2^16-1&gt;;
uint16 HpkeAeadId; // Defined in I-D.irtf-cfrg-hpke
uint16 HpkeKemId;  // Defined in I-D.irtf-cfrg-hpke
uint16 HpkeKdfId;  // Defined in I-D.irtf-cfrg-hpke
</pre><a href="#section-3.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1.2-3">[TODO: Decide whether to use the same config structure as OHTTP/ECH. This would
add support for multiple cipher suites.]<a href="#section-3.1.2-3" class="pilcrow">¶</a></p>
<p id="section-3.1.2-4">We call this a <em>key configation</em>. The key configuration is used to set up a
base-mode HPKE context to use to derive symmetric keys for protecting: (1) input
shares sent from the client to an aggregator; or (2) output shares sent from the
helper to the collector. The <em>config id</em>, <code>HpkeConfig.id</code>, is forwarded by the
sender to the receiver to help the receiver decide if it knows the decryption
key.<a href="#section-3.1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="pre-conditions">
<section id="section-3.2">
        <h3 id="name-pre-conditions">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-pre-conditions" class="section-name selfRef">Pre-conditions</a>
        </h3>
<p id="section-3.2-1">We assume the following conditions hold before execution of any PDA task begins:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.2-2">
<li id="section-3.2-2.1">The aggregators agree on a set of PDA tasks, as well as the PDA parameters
associated to each task.<a href="#section-3.2-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-2.2">Each aggregator has a clock that is roughly in sync with true time, i.e.,
within the batch window specified by the PDA parameters. (This is necessary to
prevent the same report from appearing in multiple batches.)<a href="#section-3.2-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-2.3">Each client has selected a PDA task for which it will upload a report. It is
also configured with the task's parameters.<a href="#section-3.2-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-2.4">Each client and the leader can establish a leader-authenticated secure
channel.<a href="#section-3.2-2.4" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-2.5">The leader and each helper can establish a helper-authenticated secure
channel.<a href="#section-3.2-2.5" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-2.6">The collector and leader can establish a leader-authenticated secure channel.<a href="#section-3.2-2.6" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-2.7">The collector has chosen an HPKE configuration and corresponding secret key.<a href="#section-3.2-2.7" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-2.8">Each aggregator has chosen an HPKE configuration and corresponding secret key.<a href="#section-3.2-2.8" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.2-3">[TODO: It would be clearer to include a "pre-conditions" section prior to each
"phase" of the protocol.]<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pa-upload">
<section id="section-3.3">
        <h3 id="name-upload">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-upload" class="section-name selfRef">Upload</a>
        </h3>
<span id="name-flow-of-the-upload-process"></span><div id="pa-upload-flow">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-3.3-1.1">
<pre>
Client          Leader         Helper
  |  key config  |              |
  &lt;--------------&gt;              |
  |              |  key config  |
  &lt;-----------------------------&gt;
  |  upload      |              |
  &lt;--------------&gt;              |
  v              v              v
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-flow-of-the-upload-process" class="selfRef">Flow of the upload process</a>
          </figcaption></figure>
</div>
<p id="section-3.3-2">[NOTE: @acmiyaguchi pointed out that the use of an anonymizing proxy for
uploading shares might be easier to implement if the "upload" phase involved a
single HTTP request. However, OHTTP
(https//www.ietf.org/archive/id/draft-thomson-http-oblivious-01.html) allows
clients to make multiple requests through a proxy, so these kinds of use cases
should work.]<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<div id="key-config-request">
<section id="section-3.3.1">
          <h4 id="name-key-config-request">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-key-config-request" class="section-name selfRef">Key Config Request</a>
          </h4>
<p id="section-3.3.1-1">Before the client can upload its report to the leader, it must first discover
the key configs of each of the aggregators. To do so, the client sends a GET
request to <code>[aggregator]/key_config</code>, where <code>[aggregator]</code> is the aggregator's
endpoint URL. The aggregator responds to well-formed requests with status 200
and an <code>HpkeConfig</code>.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">The client issues a key config request to <code>PDAParam.leader_url</code> and
<code>PDAParam.helper_Url</code>. It aborts if any of the following happen for either
request:<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.1-3.1">the client and aggregator failed to establish a secure,
aggregator-authenticated channel;<a href="#section-3.3.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.1-3.2">the GET request failed or didn't return a valid key config; or<a href="#section-3.3.1-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.1-3.3">the key config specifies a KEM, KDF, or AEAD algorithm the client doesn't
recognize.<a href="#section-3.3.1-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.1-4">[OPEN ISSUE: @chris-wood: Can't the leader determine if helpers are "online"?
This seems to reveal information that's specific to clients. Imagine, for
example, that clients are prohibited from talking to helpers but not the leader.
Is it OK that leaders learn that about a client? I'm not sure, so I'd be
inclined to remove this unless we have a concrete use case.]<a href="#section-3.3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-request">
<section id="section-3.3.2">
          <h4 id="name-upload-request">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-upload-request" class="section-name selfRef">Upload Request</a>
          </h4>
<p id="section-3.3.2-1">Next, the client issues a POST request to <code>[leader]/upload</code>, where <code>[leader]</code> is
the leader's endpoint URL. The payload is structured as follows:<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.2-2">
<pre>
struct {
  PDATaskID task_id;
  Time time;
  uint32 jitter;
  PDAEncryptedInputShare encrypted_input_shares&lt;1..2^16-1&gt;;
} PDAReport;
</pre><a href="#section-3.3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.3.2-3">This message is called the client's <em>report</em>. It contains the following fields:<a href="#section-3.3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-4.1">
              <code>task_id</code> is the task ID of the task for which the report is intended.<a href="#section-3.3.2-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.2-4.2">
              <code>time</code> is the time at which the report was generated. This field is used by
the aggregators to ensure the report appears in at most one batch. (See
<a href="#anti-replay" class="xref">Section 8.1.3.2</a>.)<a href="#section-3.3.2-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.2-4.3">
              <code>jitter</code> is a random number chosen by the client generating the report. This
and the timestamp field are used by the aggregators to ensure that each report
appears at most once in a batch. (See <a href="#anti-replay" class="xref">Section 8.1.3.2</a>.)<a href="#section-3.3.2-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.2-4.4">
              <code>encrypted_input_shares</code> contains the encrypted input shares of each of the
aggregators.<a href="#section-3.3.2-4.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.2-5">Encrypted input shares are structured as follows:<a href="#section-3.3.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.2-6">
<pre>
struct {
  uint8 config_id;
  opaque enc&lt;1..2^16-1&gt;;
  opaque payload&lt;1..2^16-1&gt;;
} PDAEncryptedInputShare;
</pre><a href="#section-3.3.2-6" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-3.3.2-7.1">
              <code>config_id</code> is equal to <code>HpkeConfig.id</code>, where <code>HpkeConfig</code> is the
aggregator's key config.<a href="#section-3.3.2-7.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.2-7.2">
              <code>enc</code> is the encapsulated HPKE context, used by the aggregator to decrypt its
input share.<a href="#section-3.3.2-7.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.2-7.3">
              <code>payload</code> is the encrypted input share.<a href="#section-3.3.2-7.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.2-8">To generate the report, the client begins by encoding its measurements as an
input for the PDA protocol and splitting it into input shares. (Note that the
structure of each input share depends on the PDA protocol in use, its parameters,
and the role of aggregator, i.e., whether the aggregator is a leader or helper.)
To encrypt an input share, the client first generates an HPKE
<span>[<a href="#I-D.irtf-cfrg-hpke" class="xref">I-D.irtf-cfrg-hpke</a>]</span> context for the aggregator by running<a href="#section-3.3.2-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.2-9">
<pre>
enc, context = SetupBaseS(pk, "pda input share" || server_role)
</pre><a href="#section-3.3.2-9" class="pilcrow">¶</a>
</div>
<p id="section-3.3.2-10">where <code>pk</code> is the aggregator's public key and <code>server_role</code> is a byte whose
value is <code>0x01</code> if the aggregator is the leader and <code>0x00</code> if the aggregator is
the helper. <code>enc</code> is the encapsulate HPKE context and <code>context</code> is the HPKE
context used by the client for encryption. The payload is encrypted as<a href="#section-3.3.2-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3.2-11">
<pre>
payload = context.Seal(input_share, task_id || time || jitter)
</pre><a href="#section-3.3.2-11" class="pilcrow">¶</a>
</div>
<p id="section-3.3.2-12">where <code>input_share</code> is the aggregator's input share and <code>task_id</code>, <code>time</code>, and
<code>jitter</code> are the fields of <code>PDAReport</code>.<a href="#section-3.3.2-12" class="pilcrow">¶</a></p>
<p id="section-3.3.2-13">The leader responds to well-formed requests to <code>[leader]/upload</code> with status 200
and an empty body. Malformed requests are handled as described in
<a href="#pa-error-common-aborts" class="xref">Section 3.6</a>.<a href="#section-3.3.2-13" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="pa-collect">
<section id="section-3.4">
        <h3 id="name-collect">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-collect" class="section-name selfRef">Collect</a>
        </h3>
<span id="name-flow-of-the-collect-process"></span><div id="pa-collect-flow">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-3.4-1.1">
<pre>
Collector     Leader           Helper
  |  collect 1  |                |
  +-------------&gt;                |
  |             |  aggregate 1   |
  |             &lt;----------------&gt;
  |             |  ...           |
  |             |  aggregate L   |
  |             &lt;----------------&gt;
  |             |  output share  |
  |             &lt;----------------&gt;
  &lt;-------------+                |
  |  ...        |                |
  |  collect N  |                |
  +-------------&gt;                |
  |             |  aggregate 1   |
  |             &lt;----------------&gt;
  |             |     ...        |
  |             |  aggregate L   |
  |             &lt;----------------&gt;
  |             |  output share  |
  |             &lt;----------------&gt;
  &lt;-------------+                |
  v             v                v
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-flow-of-the-collect-process" class="selfRef">Flow of the collect process with N collect requests and L aggregate requests per collect request.</a>
          </figcaption></figure>
</div>
<p id="section-3.4-2">[TODO: Decide if and how the collector's request is authenticated.]<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">The collector interacts with the leader to produce the final aggregate output.
This process consists of a sequence of <em>collect requests</em> issued to the leader.
Before a request can succeed, the aggregators must have verified and aggregated
enough reports and the leader must have obtained the helper's encrypted output
share (see <a href="#pa-aggregate" class="xref">Section 3.4.2</a>). In general, the procedure by which the aggregators
verify and aggregate reports depends on parameters carried by the collect
request. This procedure is described below in <a href="#pa-aggregate" class="xref">Section 3.4.2</a>.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<div id="collect-request">
<section id="section-3.4.1">
          <h4 id="name-collect-request">
<a href="#section-3.4.1" class="section-number selfRef">3.4.1. </a><a href="#name-collect-request" class="section-name selfRef">Collect Request</a>
          </h4>
<p id="section-3.4.1-1">[TODO: Decide whether to specify things in terms of functions. @ekr pointed out
that it would be clearer to just talk about protocol messages.]<a href="#section-3.4.1-1" class="pilcrow">¶</a></p>
<p id="section-3.4.1-2">The collect protocol is an iterative procedure driven by the collector and
parameterized by a PDAParam. At a high level, it proceeds as follows. First, the
collector initializes local per-protocol state using the corresponding
PDAParam. This state object has the following member functions:<a href="#section-3.4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4.1-3.1">CreateRequest(): Creates a PDACollectReq object, defined below, that is sent to
the leader to complete one iteration of the protocol. Along with any
protocol-specific parameters, the message specifies a time interval
<code>[batch_start, batch_end)</code> that determines the batch of reports to be
aggregated. It must be that <code>batch_end - batch_start &gt;= PDAParam.batch_window</code>
and <code>batch_start</code> and <code>batch_end</code> are multiples of <code>PDAParam.batch_window</code>.<a href="#section-3.4.1-3.1" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-3.4.1-4">
<pre>
struct {
  PDATaskID task_id;
  Time batch_start; // The beginning of the batch.
  Time batch_end;   // The end of the batch (exclusive).
  PDAProto proto;
  select (PDACollectReq.proto) {
    case prio: PrioCollectReq;
    case hits: HitsCollectReq;
  }
} PDACollectReq;
</pre><a href="#section-3.4.1-4" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-3.4.1-5.1">Update(resp: PDACollectResp): Consumes an opaque PDACollectResp object, defined
below, that is received from the leader in response to a PDACollectReq.<a href="#section-3.4.1-5.1" class="pilcrow">¶</a>
</li>
          </ul>
<div class="artwork art-text alignLeft" id="section-3.4.1-6">
<pre>
struct {
  PDATaskID task_id;
  PDAProto proto;
  PDAOutputShare leader_share;
  opaque encrypted_helper_share;
} PDACollectResp;
</pre><a href="#section-3.4.1-6" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-3.4.1-7.1">Finished(): Returns a boolean indicating indicating whether or not the collection
procedure is complete. This function returns true when the collect iteration
is complete.<a href="#section-3.4.1-7.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.4.1-7.2">Output(): Returns the aggregate output corresponding to the protocol.<a href="#section-3.4.1-7.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.4.1-8">The collect procedure for a given PDAParam structure <code>param</code> is then driven with
the following algorithm:<a href="#section-3.4.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.1-9">
<pre>
state = CreateState(param)
while not state.Finished():
   req = state.CreateRequest()
   resp = fetch([leader]/collect, req)
   state.Update(resp)
return state.Output()
</pre><a href="#section-3.4.1-9" class="pilcrow">¶</a>
</div>
<p id="section-3.4.1-10">[OPEN ISSUE: Describe how intra-protocol errors yield collect errors (see
issue#57). For example, how does a leader respond to a collect request if the
helper drops out?]<a href="#section-3.4.1-10" class="pilcrow">¶</a></p>
<p id="section-3.4.1-11">Each collect request involves one of the helpers specified by the PDA parameters.
If more than one helper is specified, the collector may issue the requests in
any order.<a href="#section-3.4.1-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pa-aggregate">
<section id="section-3.4.2">
          <h4 id="name-verifying-and-aggregating-r">
<a href="#section-3.4.2" class="section-number selfRef">3.4.2. </a><a href="#name-verifying-and-aggregating-r" class="section-name selfRef">Verifying and Aggregating Reports</a>
          </h4>
<p id="section-3.4.2-1">After the client uploads a report to the leader, the leader and helper verify in
zero knowledge that the input is valid. The exact procedure for doing so is
protocol specific, but all protocols have the same basic structure. In
particular, the protocol is comprised of a sequence of <em>aggregate requests</em> from
the leader to the helper. At the end of this procedure, the leader and helper
will have have aggregated a set of valid client inputs (though not necessarily a
complete batch).<a href="#section-3.4.2-1" class="pilcrow">¶</a></p>
<div id="aggregate-request">
<section id="section-3.4.2.1">
            <h5 id="name-aggregate-request">
<a href="#section-3.4.2.1" class="section-number selfRef">3.4.2.1. </a><a href="#name-aggregate-request" class="section-name selfRef">Aggregate Request</a>
            </h5>
<p id="section-3.4.2.1-1">The process begins with a PDACollectReq. The leader collects a sequence of
reports that are all associated with the same PDA task. Let <code>[helper]</code> denote
<code>PDAParam.helper_url</code>, where <code>PDAParam</code> is the PDA parameters structure associated
<code>PDAAggregateReq.task.id</code>. The leader sends a POST request to
<code>[helper]/aggregate</code> with the following message:<a href="#section-3.4.2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.1-2">
<pre>
struct {
  PDATaskID task_id;
  opaque helper_state&lt;0..2^16&gt;;
  PDAAggregateSubReq seq&lt;1..2^24-1&gt;;
} PDAAggregateReq;
</pre><a href="#section-3.4.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.1-3">The structure contains the PDA task, the helper's HPKE config id, an opaque
<em>helper state</em> string, and a sequence of <em>sub-requests</em>, each corresponding to a
unique client report. Sub-requests are structured as follows:<a href="#section-3.4.2.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.1-4">
<pre>
struct {
  Time time;     // Equal to PDAReport.time.
  uint32 jitter; // Equal to PDAReport.jitter.
  PDAEncryptedInputShare helper_share;
  select (PDAParam.proto) { // PDAParam for the PDA task
    case prio: PrioAggregateSubReq;
    case hits: HitsAggregateSubReq;
  }
} PDAAggregateSubReq;
</pre><a href="#section-3.4.2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.1-5">The <code>time</code> and <code>jitter</code> fields have the same value as those in the report
uploaded by the client. Similarly, the <code>helper_share</code> field is the helper's
encrypted input share as it appeared in the report. [OPEN ISSUE: We usually only
need to send this in the first aggregate request. Shall we exclude it in
subsequent requests somehow?] The remainder of the structure is dedicated to the
protocol-specific request parameters.<a href="#section-3.4.2.1-5" class="pilcrow">¶</a></p>
<p id="section-3.4.2.1-6">In order to provide replay protection, the leader is required to send aggregate
sub-requests in ascending order, where the ordering on sub-requests is
determined by the algorithm defined in <a href="#anti-replay" class="xref">Section 8.1.3.2</a>. Specifically, the leader
constructs its request such that:
* Each sub-request must follow the previous sub-request; and
* The first sub-request must follow the last sub-request in the previous
  aggregate request.<a href="#section-3.4.2.1-6" class="pilcrow">¶</a></p>
<p id="section-3.4.2.1-7">The helper handles well-formed requests as follows. (As usual, malformed
requests are handled as described in <a href="#pa-error-common-aborts" class="xref">Section 3.6</a>.) It first looks
for the PDA parameters <code>PDAParam</code> for which <code>PDAAggregateReq.task_id</code> is equal
to the task ID derived from <code>PDAParam</code>. It then filters out out-of-order
sub-requests by ignoring any sub-request that does not follow the previous
sub-request. (See <a href="#anti-replay" class="xref">Section 8.1.3.2</a>.)<a href="#section-3.4.2.1-7" class="pilcrow">¶</a></p>
<p id="section-3.4.2.1-8">The response consists of the helper's updated state and a sequence of
<em>sub-responses</em>, where the i-th sub-response corresponds to the sub-request for
each i. The structure of each sub-response is specific to the PDA protocol:<a href="#section-3.4.2.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.1-9">
<pre>
struct {
  opaque helper_state&lt;0..2^16&gt;;
  PDAAggregateSubResp seq&lt;1..2^24-1&gt;;
} PDAAggregateResp;

struct {
  Time time;     // Equal to PDAAggregateSubReq.time.
  uint32 jitter; // Equal to PDAAggregateSubReq.jitter.
  select (PDAParam.proto) { // PDAParam for the PDA task
    case prio: PrioAggregateSubResp;
    case hits: HitsAggregateSubResp;
  }
} PDAAggregateSubResp;
</pre><a href="#section-3.4.2.1-9" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.1-10">The helper handles each sub-request <code>PDAAggregateSubReq</code> as follows. It first
looks up the HPKE config and corresponding secret key associated with
<code>helper_share.config_id</code>. If not found, then the sub-response consists of an
"unrecognized config" alert. [TODO: We'll want to be more precise about what
this means. See issue#57.] Next, it attempts to decrypt the payload with the
following procedure:<a href="#section-3.4.2.1-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.1-11">
<pre>
context = SetupBaseR(helper_share.enc, sk,
                     "pda input share" || server_role)
input_share = context.Open(helper_share,
                           task_id || time || jitter)
</pre><a href="#section-3.4.2.1-11" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.1-12">where <code>sk</code> is the HPKE secret key and <code>server_role</code> is the role of the server
(<code>0x01</code> for the leader and <code>0x00</code> for the helper). If decryption fails, then the
sub-response consists of a "decryption error" alert. [See issue#57.] Otherwise,
the helper handles the request for its plaintext input share <code>input_share</code> and
updates its state as specified by the PDA protocol.<a href="#section-3.4.2.1-12" class="pilcrow">¶</a></p>
<p id="section-3.4.2.1-13">After processing all of the sub-requests, the helper encrypts its updated state
and constructs its response to the aggregate request.<a href="#section-3.4.2.1-13" class="pilcrow">¶</a></p>
<div id="helper-state">
<section id="section-3.4.2.1.1">
              <h6 id="name-helper-state">
<a href="#section-3.4.2.1.1" class="section-number selfRef">3.4.2.1.1. </a><a href="#name-helper-state" class="section-name selfRef">Helper State</a>
              </h6>
<p id="section-3.4.2.1.1-1">The helper state is an optional parameter of an aggregate request that the can
helper use to carry state across requests. At least part of the state will
usually need to be encrypted in order to protect user privacy. However, the
details of precisely how the state is encrypted and the information that it
carries is up to the helper implementation.<a href="#section-3.4.2.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="output-share-request">
<section id="section-3.4.2.2">
            <h5 id="name-output-share-request">
<a href="#section-3.4.2.2" class="section-number selfRef">3.4.2.2. </a><a href="#name-output-share-request" class="section-name selfRef">Output Share Request</a>
            </h5>
<p id="section-3.4.2.2-1">Once the aggregators have verified at least as many reports as required for the
PDA task, the leader issues an <em>output share request</em> to the helper. The helper
responds to this request by extracting its output share from its state and
encrypting it under the collector's HPKE public key.<a href="#section-3.4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.4.2.2-2">The leader sends a POST request to <code>[helper]/output_share</code> with the following
message:<a href="#section-3.4.2.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.2-3">
<pre>
struct {
  PDATaskID task_id;
  Time batch_start; // Same as PDACollectReq.batch_start.
  Time batch_end;   // Same as PDACollectReq.batch_end.
  opaque helper_state&lt;0..2^16&gt;;
} PDAOutputShareReq;
</pre><a href="#section-3.4.2.2-3" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.2-4">To respond to valid output share requests, the helper first checks that
<code>batch_start</code> and <code>batch_end</code> are multiples of <code>task.batch_window</code> and that
<code>batch_end - batch_start &gt;= task.batch_window</code>. Next, it extracts from its state
the set of input shares that fall in the window <code>[batch_start, batch_end)</code>. If
the size of the batch is less than <code>task.batch_size</code>, then it aborts and alerts
the leader with "insufficient data". Otherwise, it computes its output share,
which has the following structure:<a href="#section-3.4.2.2-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.2-5">
<pre>
struct {
  PDAProto proto;
  select (PDAOutputShare.proto) {
    case prio: PrioOutputShare;
    case hits: HitsOutputShare;
  }
} PDAOutputShare;
</pre><a href="#section-3.4.2.2-5" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.2-6">Next, it encrypts its output share under the collector's HPKE public key:<a href="#section-3.4.2.2-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.2-7">
<pre>
enc, context = SetupBaseS(pk, "pda output share")
encrypted_output_share = context.Seal(output_share,
                            task_id || batch_start || batch_end)
</pre><a href="#section-3.4.2.2-7" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.2-8">where <code>pk</code> is the HPKE public key encoded by the collector's HPKE key
configuration and <code>output_share</code> is its serialized output share.<a href="#section-3.4.2.2-8" class="pilcrow">¶</a></p>
<p id="section-3.4.2.2-9">It responds with the following message:<a href="#section-3.4.2.2-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4.2.2-10">
<pre>
struct {
  uint8 collector_hpke_config_id;
  opaque enc&lt;1..2^16-1&gt;;
  opaque encrypted_output_share&lt;1..2^16&gt;;
} PDAOutputShareResp;
</pre><a href="#section-3.4.2.2-10" class="pilcrow">¶</a>
</div>
<p id="section-3.4.2.2-11">The leader uses the helper's output share response to respond to the collector's
collect request (see <a href="#pa-collect" class="xref">Section 3.4</a>).<a href="#section-3.4.2.2-11" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="pa-error">
<section id="section-3.5">
        <h3 id="name-error-handling">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-error-handling" class="section-name selfRef">Error handling</a>
        </h3>
<p id="section-3.5-1">An <em>alert</em> is a message sent either in an HTTP request or response that signals
to the receiver that the peer has aborted the protocol. The payload is<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.5-2">
<pre>
struct {
  PDATaskID task_id;
  opaque payload&lt;1..255&gt;;
} PDAAlert;
</pre><a href="#section-3.5-2" class="pilcrow">¶</a>
</div>
<p id="section-3.5-3">where <code>task</code> is the associated PDA task (this value is always known) and
<code>payload</code> is the message. When sent by an aggregator in response to an HTTP
request, the response status is 400. When sent in a request to an aggregator,
the URL is always <code>[aggregator]/error</code>, where <code>[aggregator]</code> is the URL of the
aggregator endpoint.<a href="#section-3.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pa-error-common-aborts">
<section id="section-3.6">
        <h3 id="name-common-abort-conditions">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-common-abort-conditions" class="section-name selfRef">Common abort conditions</a>
        </h3>
<p id="section-3.6-1">The following specify the "boiler-plate" behavior for various error conditions.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.6-2.1">The message type for the payload of each request and response is unique for a
given URL. If ever a client, aggregator, or collector receives a request or
response to a request with a malformed payload, then the receiver aborts and
alerts the peer with "unrecognized message".<a href="#section-3.6-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.6-2.2">Each POST request to an aggregator contains a <code>PDATaskID</code>. If the aggregator
does not recognize the task, i.e., it can't find a <code>PDAParam</code> for which the
derived task ID matches the <code>PDATaskID</code>, then it aborts and alerts the peer
with "unrecognized task".<a href="#section-3.6-2.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="prio">
<section id="section-4">
      <h2 id="name-prio">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-prio" class="section-name selfRef">Prio</a>
      </h2>
<p id="section-4-1">[TODO: Define Prio-specific protocol messages.]<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="parameters">
<section id="section-4.1">
        <h3 id="name-parameters">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-parameters" class="section-name selfRef">Parameters</a>
        </h3>
<div id="finite-field-arithmetic">
<section id="section-4.1.1">
          <h4 id="name-finite-field-arithmetic">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-finite-field-arithmetic" class="section-name selfRef">Finite field arithmetic</a>
          </h4>
<p id="section-4.1.1-1">The algorithms that comprise the input-validation protocol --- Prove, Query, and
Decide --- are constructed by generating and evaluating polynomials over a
finite field. As such, the main ingredient of Prio is an implementation of
arithmetic in a finite field suitable for the given application.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">We will use a prime field. The choice of prime is influenced by the following
criteria:<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1.1-3">
<li id="section-4.1.1-3.1">
              <strong>Field size.</strong> How big the field needs to be depends on the type of data
being aggregated and how many users there are. The field size also impacts
the security level: the longer the validity circuit, the larger the field
needs to be in order to effectively detect malicious clients. Typically the
soundness error (i.e., the probability of an invalid input being deemed valid
by the aggregators) will be 2n/(p-n), where n is the size of the input and p
is the prime modulus.<a href="#section-4.1.1-3.1" class="pilcrow">¶</a>
</li>
            <li id="section-4.1.1-3.2">
              <strong>Fast polynomial operations.</strong> In order to make Prio practical, it's
important that implementations employ FFT to speed up polynomial operations.
In particular, the prime modulus p should be chosen so that (p-1) = 2^b * s
for large b and odd s. Then g^s is a principle, 2^b-th root of unity (i.e.,
g^(s*2^b) = 1), where g is the generator of the multiplicative subgroup.
This fact allows us to quickly evaluate and interpolate polynomials at 2^a-th
roots of unity for any 1 &lt;= a &lt;= b. Note that b imposes an upper bound on the
size of proofs, so it should be large enough to accommodate all foreseeable
use cases. Something like b &gt;= 20 is probably good enough.<a href="#section-4.1.1-3.2" class="pilcrow">¶</a>
</li>
            <li id="section-4.1.1-3.3">
              <strong>As close to a power of two as possible.</strong> We use rejection sampling to map
a PRNG seed to a pseudorandom sequence of field elements (see <a href="#prio-prng" class="xref">Section 4.1.2</a>).
In order to minimize the probability of a simple being rejected, the modulus
should be as close to a power of 2 as possible.<a href="#section-4.1.1-3.3" class="pilcrow">¶</a>
</li>
            <li id="section-4.1.1-3.4">
              <strong>Code optimization.</strong> [[TODO: What properties of the field make
it possible to write faster implementations?]]<a href="#section-4.1.1-3.4" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-4.1.1-4">The table below lists parameters that meet these criteria at various levels of
security. (Note that #1 is the field used in "Prio v2".) The "size" column
indicates the number of bits required to represent elements of the field.<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
            <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">#</th>
                <th class="text-left" rowspan="1" colspan="1">size</th>
                <th class="text-left" rowspan="1" colspan="1">p</th>
                <th class="text-left" rowspan="1" colspan="1">g</th>
                <th class="text-left" rowspan="1" colspan="1">b</th>
                <th class="text-left" rowspan="1" colspan="1">s</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">32</td>
                <td class="text-left" rowspan="1" colspan="1">4293918721</td>
                <td class="text-left" rowspan="1" colspan="1">19</td>
                <td class="text-left" rowspan="1" colspan="1">20</td>
                <td class="text-left" rowspan="1" colspan="1">3^2 * 5 * 7 * 13</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">64</td>
                <td class="text-left" rowspan="1" colspan="1">15564440312192434177</td>
                <td class="text-left" rowspan="1" colspan="1">5</td>
                <td class="text-left" rowspan="1" colspan="1">59</td>
                <td class="text-left" rowspan="1" colspan="1">3^3</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">80</td>
                <td class="text-left" rowspan="1" colspan="1">779190469673491460259841</td>
                <td class="text-left" rowspan="1" colspan="1">14</td>
                <td class="text-left" rowspan="1" colspan="1">72</td>
                <td class="text-left" rowspan="1" colspan="1">3 * 5 * 11</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">4</td>
                <td class="text-left" rowspan="1" colspan="1">123</td>
                <td class="text-left" rowspan="1" colspan="1">9304595970494411110326649421962412033</td>
                <td class="text-left" rowspan="1" colspan="1">3</td>
                <td class="text-left" rowspan="1" colspan="1">120</td>
                <td class="text-left" rowspan="1" colspan="1">7</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">5</td>
                <td class="text-left" rowspan="1" colspan="1">126</td>
                <td class="text-left" rowspan="1" colspan="1">74769074762901517850839147140769382401</td>
                <td class="text-left" rowspan="1" colspan="1">7</td>
                <td class="text-left" rowspan="1" colspan="1">118</td>
                <td class="text-left" rowspan="1" colspan="1">3^2 * 5^2</td>
              </tr>
            </tbody>
          </table>
<p id="section-4.1.1-6">[TODO: Choose new parameters for 2, 3, and 5 so that p is as close to 2^size as
possible without going over. (4 is already close enough; 1 is already deployed
and can't be changed.]<a href="#section-4.1.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1.1-7"><strong>Finding suitable primes.</strong>
One way to find suitable primes is to first choose choose b, then "probe" to
find a prime of the desired size. The following SageMath script prints the
parameters of a number of (probable) primes larger than 2^b for a given b:<a href="#section-4.1.1-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-8">
<pre>
b = 116
for s in range(0,1000,1):
    B = 2^b
    p = (B*s).next_prime()
    if p-(B*s) == 1:
        bits = round(math.log2(p), 2)
        print(bits, p, GF(p).multiplicative_generator(), b, factor(s))
</pre><a href="#section-4.1.1-8" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="prio-prng">
<section id="section-4.1.2">
          <h4 id="name-pseudorandom-number-generat">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-pseudorandom-number-generat" class="section-name selfRef">Pseudorandom number generation</a>
          </h4>
<p id="section-4.1.2-1">A suitable PRNG will have the following syntax. Fix a finite field K:<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1.2-2">
<li id="section-4.1.2-2.1">x := PRNG(k, n) denotes generation of a vector of n elements of K.<a href="#section-4.1.2-2.1" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-4.1.2-3">This can be instantiated using a standard stream cipher, e.g., AES-CTR, as
follows. Interpret the seed k as the key and IV for generating the AES-CTR key
stream. Proceed by rejection sampling, as follows. Let m be the number of bits
needed to encode an element of K. Generate the next m bits of key stream and
interpret the bytes as an integer x, clearing the most significant m - l bits,
where l is the bit-length of the modulus p. If x &lt; p, then output x. Otherwise,
generate the next m bits of key stream and try again. Repeat this process
indefinitely until a suitable output is found.<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="hits">
<section id="section-5">
      <h2 id="name-hits">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-hits" class="section-name selfRef">Hits</a>
      </h2>
<p id="section-5-1">[TODO: Define Hits-specific protocol messages.]<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="system-design">
<section id="section-6">
      <h2 id="name-system-design">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-system-design" class="section-name selfRef">System design</a>
      </h2>
<p id="section-6-1">[[OPEN ISSUE: This section seems like a catch-all for things not in other
sections. Perhaps there is a natural home for aggregator discovery, share
uploading, open issues, and system parameters?]]<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="aggregator-discovery">
<section id="section-6.1">
        <h3 id="name-aggregator-discovery">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-aggregator-discovery" class="section-name selfRef">Aggregator discovery</a>
        </h3>
<p id="section-6.1-1">[[OPEN ISSUE: writeme]]<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="share-uploading">
<section id="section-6.2">
        <h3 id="name-share-uploading">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-share-uploading" class="section-name selfRef">Share uploading</a>
        </h3>
<p id="section-6.2-1">[[OPEN ISSUE: writeme]]<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="questions-and-params">
<section id="section-6.3">
        <h3 id="name-open-questions-and-system-p">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-open-questions-and-system-p" class="section-name selfRef">Open questions and system parameters</a>
        </h3>
<p id="section-6.3-1">[[OPEN ISSUE: discuss batch size parameter and thresholds]]
[[OPEN ISSUE: discuss f^ leakage differences from [GB17]]]<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="operational-considerations">
<section id="section-7">
      <h2 id="name-operational-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-7-1">Prio has inherent constraints derived from the tradeoff between privacy
guarantees and computational complexity. These tradeoffs influence how
applications may choose to utilize services implementing the specification.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="data-resolution-limitations">
<section id="section-7.1">
        <h3 id="name-data-resolution-limitations">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-data-resolution-limitations" class="section-name selfRef">Data resolution limitations</a>
        </h3>
<p id="section-7.1-1">Privacy comes at the cost of computational complexity. While affine-aggregatable
encodings (AFEs) can compute many useful statistics, they require more bandwidth
and CPU cycles to account for finite-field arithmetic during input-validation.
The increased work from verifying inputs decreases the throughput of the system
or the inputs processed per unit time. Throughput is related to the verification
circuit's complexity and the available compute-time to each aggregator.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">Applications that utilize proofs with a large number of multiplication gates or
a high frequency of inputs may need to limit inputs into the system to meet
bandwidth or compute constraints. Some methods of overcoming these limitations
include choosing a better representation for the data or introducing sampling
into the data collection methodology.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">[[TODO: Discuss explicit key performance indicators, here or elsewhere.]]<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-utility-and-soft-batch-deadlines">
<section id="section-7.2">
        <h3 id="name-aggregation-utility-and-sof">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-aggregation-utility-and-sof" class="section-name selfRef">Aggregation utility and soft batch deadlines</a>
        </h3>
<p id="section-7.2-1">A soft real-time system should produce a response within a deadline to
be useful. This constraint may be relevant when the value of an aggregate
decreases over time. A missed deadline can reduce an aggregate's utility
but not necessarily cause failure in the system.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">An example of a soft real-time constraint is the expectation that input data can
be verified and aggregated in a period equal to data collection, given some
computational budget. Meeting these deadlines will require efficient
implementations of the input-validation protocol. Applications might batch
requests or utilize more efficient serialization to improve throughput.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">Some applications may be constrained by the time that it takes to reach a
privacy threshold defined by a minimum number of input shares. One possible
solution is to increase the reporting period so more samples can be collected,
balanced against the urgency of responding to a soft deadline.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="data-integrity-constraints">
<section id="section-7.3">
        <h3 id="name-data-integrity-constraints">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-data-integrity-constraints" class="section-name selfRef">Data integrity constraints</a>
        </h3>
<p id="section-7.3-1">Data integrity concerns the accuracy and correctness of the outputs in the
system. The integrity of the output can be influenced by an incomplete round of
aggregation caused by network partitions, or by bad actors attempting to cause
inaccuracies in the aggregates. An example data integrity constraint is that
every share must be processed exactly once by all aggregators. Data integrity
constraints may be at odds with the threat model if meeting the constraints
requires replaying data.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">Aggregator operators should expect to encounter invalid inputs during regular
operation due to misconfigured or malicious clients. Low volumes of errors are
tolerable; the input-verification protocol and AFEs are robust in the face of
malformed data. Aggregators may need to detect and mitigate statistically
significant floods of invalid or identical inputs that affect accuracy, e.g.,
denial of service (DoS) events.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<p id="section-7.3-3">Certain classes of errors do not exist in the input-validation protocol
considered in this document. For example, packet loss errors when clients make
requests directly to aggregators are not relevant when the leader proxies
requests and controls the schedule for signaling aggregation rounds.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="security-requirements">
<section id="section-8.1">
        <h3 id="name-security-overview">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-security-overview" class="section-name selfRef">Security overview</a>
        </h3>
<p id="section-8.1-1">Prio assumes a powerful adversary with the ability to compromise an unbounded
number of clients. In doing so, the adversary can provide malicious (yet
truthful) inputs to the aggregation function. Prio also assumes that all but one
server operates honestly, where a dishonest server does not execute the protocol
faithfully as specified. The system also assumes that servers communicate over
secure and mutually authenticated channels. In practice, this can be done by TLS
or some other form of application-layer authentication.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">In the presence of this adversary, Prio provides two important properties for
computing an aggergation function F:<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.1-3">
<li id="section-8.1-3.1">Privacy. The aggregators and collector learn only the output of F computed
over all client inputs, and nothing else.<a href="#section-8.1-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-8.1-3.2">Robustness. As long as the aggregators execute the input-validation protocol
correctly, a malicious client can skew the output of F only by reporting
false (untruthful) input. The output cannot be influenced in any other way.<a href="#section-8.1-3.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-8.1-4">There are several additional constraints that a Prio deployment must satisfy in
order to achieve these goals:<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.1-5">
<li id="section-8.1-5.1">Minimum batch size. The aggregation batch size has an obvious impact on
privacy. (A batch size of one hides nothing of the input.)
<a href="#questions-and-params" class="xref">Section 6.3</a> discusses appropriate batch sizes and how they
pertains to privacy in more detail.<a href="#section-8.1-5.1" class="pilcrow">¶</a>
</li>
          <li id="section-8.1-5.2">Aggregation function choice. Some aggregation functions leak slightly more
than the function output itself. <a href="#questions-and-params" class="xref">Section 6.3</a> discusses the
leakage profiles of various aggregation functions in more detail.<a href="#section-8.1-5.2" class="pilcrow">¶</a>
</li>
        </ol>
<div id="threat-model">
<section id="section-8.1.1">
          <h4 id="name-threat-model">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-threat-model" class="section-name selfRef">Threat model</a>
          </h4>
<p id="section-8.1.1-1">In this section, we enumerate the actors participating in the Prio system and
enumerate their assets (secrets that are either inherently valuable or which
confer some capability that enables further attack on the system), the
capabilities that a malicious or compromised actor has, and potential
mitigations for attacks enabled by those capabilities.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">This model assumes that all participants have previously agreed upon and
exchanged all shared parameters over some unspecified secure channel.<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<div id="clientuser">
<section id="section-8.1.1.1">
            <h5 id="name-client-user">
<a href="#section-8.1.1.1" class="section-number selfRef">8.1.1.1. </a><a href="#name-client-user" class="section-name selfRef">Client/user</a>
            </h5>
<div id="assets">
<section id="section-8.1.1.1.1">
              <h6 id="name-assets">
<a href="#section-8.1.1.1.1" class="section-number selfRef">8.1.1.1.1. </a><a href="#name-assets" class="section-name selfRef">Assets</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.1.1-1">
<li id="section-8.1.1.1.1-1.1">Unshared inputs. Clients are the only actor that can ever see the original
inputs.<a href="#section-8.1.1.1.1-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.1.1-1.2">Unencrypted input shares.<a href="#section-8.1.1.1.1-1.2" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
<div id="capabilities">
<section id="section-8.1.1.1.2">
              <h6 id="name-capabilities">
<a href="#section-8.1.1.1.2" class="section-number selfRef">8.1.1.1.2. </a><a href="#name-capabilities" class="section-name selfRef">Capabilities</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.1.2-1">
<li id="section-8.1.1.1.2-1.1">
                  <p id="section-8.1.1.1.2-1.1.1">Individual users can reveal their own input and compromise their own privacy.<a href="#section-8.1.1.1.2-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.1.2-1.1.2.1">Since this does not affect the privacy of others in the system, it is
outside the threat model.<a href="#section-8.1.1.1.2-1.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li id="section-8.1.1.1.2-1.2">
                  <p id="section-8.1.1.1.2-1.2.1">Clients (that is, software which might be used by many users of the system)
can defeat privacy by leaking input outside of the Prio system.<a href="#section-8.1.1.1.2-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.1.2-1.2.2.1">In the current threat model, other participants have no insight into what
clients do besides uploading input shares. Accordingly, such attacks are
outside of the threat model.<a href="#section-8.1.1.1.2-1.2.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li id="section-8.1.1.1.2-1.3">
                  <p id="section-8.1.1.1.2-1.3.1">Clients may affect the quality of aggregations by reporting false input.<a href="#section-8.1.1.1.2-1.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.1.2-1.3.2.1">Prio can only prove that submitted input is valid, not that it is true.
False input can be mitigated orthogonally to the Prio protocol (e.g., by
requiring that aggregations include a minimum number of contributions)
and so these attacks are considered to be outside of the threat model.<a href="#section-8.1.1.1.2-1.3.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li id="section-8.1.1.1.2-1.4">Clients can send invalid encodings of input.<a href="#section-8.1.1.1.2-1.4" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
<div id="mitigations">
<section id="section-8.1.1.1.3">
              <h6 id="name-mitigations">
<a href="#section-8.1.1.1.3" class="section-number selfRef">8.1.1.1.3. </a><a href="#name-mitigations" class="section-name selfRef">Mitigations</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.1.3-1">
<li id="section-8.1.1.1.3-1.1">The input validation protocol executed by the aggregators prevents either
individual clients or coalitions of clients from compromising the robustness
property.<a href="#section-8.1.1.1.3-1.1" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
</section>
</div>
<div id="aggregator">
<section id="section-8.1.1.2">
            <h5 id="name-aggregator">
<a href="#section-8.1.1.2" class="section-number selfRef">8.1.1.2. </a><a href="#name-aggregator" class="section-name selfRef">Aggregator</a>
            </h5>
<div id="assets-1">
<section id="section-8.1.1.2.1">
              <h6 id="name-assets-2">
<a href="#section-8.1.1.2.1" class="section-number selfRef">8.1.1.2.1. </a><a href="#name-assets-2" class="section-name selfRef">Assets</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.2.1-1">
<li id="section-8.1.1.2.1-1.1">Unencrypted input shares.<a href="#section-8.1.1.2.1-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.2.1-1.2">Input share decryption keys.<a href="#section-8.1.1.2.1-1.2" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.2.1-1.3">Client identifying information.<a href="#section-8.1.1.2.1-1.3" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.2.1-1.4">Output shares.<a href="#section-8.1.1.2.1-1.4" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.2.1-1.5">Aggregator identity.<a href="#section-8.1.1.2.1-1.5" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
<div id="capabilities-1">
<section id="section-8.1.1.2.2">
              <h6 id="name-capabilities-2">
<a href="#section-8.1.1.2.2" class="section-number selfRef">8.1.1.2.2. </a><a href="#name-capabilities-2" class="section-name selfRef">Capabilities</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.2.2-1">
<li id="section-8.1.1.2.2-1.1">Aggregators may defeat the robustness of the system by emitting bogus output
shares.<a href="#section-8.1.1.2.2-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.2.2-1.2">
                  <p id="section-8.1.1.2.2-1.2.1">If clients reveal identifying information to aggregators (such as a trusted
identity during client authentication), aggregators can learn which clients
are contributing input.<a href="#section-8.1.1.2.2-1.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.2.2-1.2.2">
<li id="section-8.1.1.2.2-1.2.2.1">Aggregators may reveal that a particular client contributed input.<a href="#section-8.1.1.2.2-1.2.2.1" class="pilcrow">¶</a>
</li>
                    <li id="section-8.1.1.2.2-1.2.2.2">
                      <p id="section-8.1.1.2.2-1.2.2.2.1">Aggregators may attack robustness by selectively omitting inputs from
certain clients.<a href="#section-8.1.1.2.2-1.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.2.2-1.2.2.2.2.1">For example, omitting submissions from a particular geographic
region to falsely suggest that a particular localization is not
being used.<a href="#section-8.1.1.2.2-1.2.2.2.2.1" class="pilcrow">¶</a>
</li>
                      </ul>
</li>
                  </ol>
</li>
                <li id="section-8.1.1.2.2-1.3">Individual aggregators may compromise availability of the system by refusing
to emit output shares.<a href="#section-8.1.1.2.2-1.3" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.2.2-1.4">Input validity proof forging. Any aggregator can collude with a malicious
client to craft a proof share that will fool honest aggregators into accepting
invalid input.<a href="#section-8.1.1.2.2-1.4" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
<div id="mitigations-1">
<section id="section-8.1.1.2.3">
              <h6 id="name-mitigations-2">
<a href="#section-8.1.1.2.3" class="section-number selfRef">8.1.1.2.3. </a><a href="#name-mitigations-2" class="section-name selfRef">Mitigations</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.2.3-1">
<li id="section-8.1.1.2.3-1.1">The linear secret sharing scheme employed by the client ensures that privacy
is preserved as long as at least one aggregator does not reveal its input
shares.<a href="#section-8.1.1.2.3-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.2.3-1.2">If computed over a sufficient number of input shares, output shares reveal
nothing about either the inputs or the participating clients.<a href="#section-8.1.1.2.3-1.2" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
</section>
</div>
<div id="leader">
<section id="section-8.1.1.3">
            <h5 id="name-leader">
<a href="#section-8.1.1.3" class="section-number selfRef">8.1.1.3. </a><a href="#name-leader" class="section-name selfRef">Leader</a>
            </h5>
<p id="section-8.1.1.3-1">The leader is also an aggregator, and so all the assets, capabilities and
mitigations available to aggregators also apply to the leader.<a href="#section-8.1.1.3-1" class="pilcrow">¶</a></p>
<div id="capabilities-2">
<section id="section-8.1.1.3.1">
              <h6 id="name-capabilities-3">
<a href="#section-8.1.1.3.1" class="section-number selfRef">8.1.1.3.1. </a><a href="#name-capabilities-3" class="section-name selfRef">Capabilities</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.3.1-1">
<li id="section-8.1.1.3.1-1.1">
                  <p id="section-8.1.1.3.1-1.1.1">Input validity proof verification. The leader can forge proofs and collude
with a malicious client to trick aggregators into aggregating invalid inputs.<a href="#section-8.1.1.3.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.3.1-1.1.2.1">This capability is no stronger than any aggregator's ability to forge
validity proof shares in collusion with a malicious client.<a href="#section-8.1.1.3.1-1.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li id="section-8.1.1.3.1-1.2">
                  <p id="section-8.1.1.3.1-1.2.1">Relaying messages between aggregators. The leader can compromise availability
by dropping messages.<a href="#section-8.1.1.3.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.3.1-1.2.2.1">This capability is no stronger than any aggregator's ability to refuse to
emit output shares.<a href="#section-8.1.1.3.1-1.2.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li id="section-8.1.1.3.1-1.3">Shrinking the anonymity set. The leader instructs aggregators to construct
output parts and so could request aggregations over few inputs.<a href="#section-8.1.1.3.1-1.3" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
<div id="mitigations-2">
<section id="section-8.1.1.3.2">
              <h6 id="name-mitigations-3">
<a href="#section-8.1.1.3.2" class="section-number selfRef">8.1.1.3.2. </a><a href="#name-mitigations-3" class="section-name selfRef">Mitigations</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.3.2-1">
<li id="section-8.1.1.3.2-1.1">Aggregators enforce agreed upon minimum aggregation thresholds to prevent
deanonymizing.<a href="#section-8.1.1.3.2-1.1" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
</section>
</div>
<div id="collector">
<section id="section-8.1.1.4">
            <h5 id="name-collector">
<a href="#section-8.1.1.4" class="section-number selfRef">8.1.1.4. </a><a href="#name-collector" class="section-name selfRef">Collector</a>
            </h5>
<div id="capabilities-3">
<section id="section-8.1.1.4.1">
              <h6 id="name-capabilities-4">
<a href="#section-8.1.1.4.1" class="section-number selfRef">8.1.1.4.1. </a><a href="#name-capabilities-4" class="section-name selfRef">Capabilities</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.4.1-1">
<li id="section-8.1.1.4.1-1.1">Advertising shared configuration parameters (e.g., minimum thresholds for
aggregations, joint randomness, arithmetic circuits).<a href="#section-8.1.1.4.1-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.4.1-1.2">Collectors may trivially defeat availability by discarding output shares
submitted by aggregators.<a href="#section-8.1.1.4.1-1.2" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
<div id="mitigations-3">
<section id="section-8.1.1.4.2">
              <h6 id="name-mitigations-4">
<a href="#section-8.1.1.4.2" class="section-number selfRef">8.1.1.4.2. </a><a href="#name-mitigations-4" class="section-name selfRef">Mitigations</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.4.2-1">
<li id="section-8.1.1.4.2-1.1">Aggregators should refuse shared parameters that are trivially insecure
(i.e., aggregation threshold of 1 contribution).<a href="#section-8.1.1.4.2-1.1" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
</section>
</div>
<div id="aggregator-collusion">
<section id="section-8.1.1.5">
            <h5 id="name-aggregator-collusion">
<a href="#section-8.1.1.5" class="section-number selfRef">8.1.1.5. </a><a href="#name-aggregator-collusion" class="section-name selfRef">Aggregator collusion</a>
            </h5>
<p id="section-8.1.1.5-1">If all aggregators collude (e.g. by promiscuously sharing unencrypted input
shares), then none of the properties of the system hold. Accordingly, such
scenarios are outside of the threat model.<a href="#section-8.1.1.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attacker-on-the-network">
<section id="section-8.1.1.6">
            <h5 id="name-attacker-on-the-network">
<a href="#section-8.1.1.6" class="section-number selfRef">8.1.1.6. </a><a href="#name-attacker-on-the-network" class="section-name selfRef">Attacker on the network</a>
            </h5>
<p id="section-8.1.1.6-1">We assume the existence of attackers on the network links between participants.<a href="#section-8.1.1.6-1" class="pilcrow">¶</a></p>
<div id="capabilities-4">
<section id="section-8.1.1.6.1">
              <h6 id="name-capabilities-5">
<a href="#section-8.1.1.6.1" class="section-number selfRef">8.1.1.6.1. </a><a href="#name-capabilities-5" class="section-name selfRef">Capabilities</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.6.1-1">
<li id="section-8.1.1.6.1-1.1">
                  <p id="section-8.1.1.6.1-1.1.1">Observation of network traffic. Attackers may observe messages exchanged
between participants at the IP layer.<a href="#section-8.1.1.6.1-1.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.6.1-1.1.2">
<li id="section-8.1.1.6.1-1.1.2.1">
                      <p id="section-8.1.1.6.1-1.1.2.1.1">The time of transmission of input shares by clients could reveal
information about user activity.<a href="#section-8.1.1.6.1-1.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.6.1-1.1.2.1.2.1">For example, if a user opts into a new feature, and the client
immediately reports this to aggregators, then just by observing
network traffic, the attacker can infer what the user did.<a href="#section-8.1.1.6.1-1.1.2.1.2.1" class="pilcrow">¶</a>
</li>
                      </ul>
</li>
                    <li id="section-8.1.1.6.1-1.1.2.2">
                      <p id="section-8.1.1.6.1-1.1.2.2.1">Observation of message size could allow the attacker to learn how much
input is being submitted by a client.<a href="#section-8.1.1.6.1-1.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1.6.1-1.1.2.2.2.1">For example, if the attacker observes an encrypted message of some
size, they can infer the size of the plaintext, plus or minus the
cipher block size. From this they may be able to infer which
aggregations the user has opted into or out of.<a href="#section-8.1.1.6.1-1.1.2.2.2.1" class="pilcrow">¶</a>
</li>
                      </ul>
</li>
                  </ol>
</li>
                <li id="section-8.1.1.6.1-1.2">Tampering with network traffic. Attackers may drop messages or inject new
messages into communications between participants.<a href="#section-8.1.1.6.1-1.2" class="pilcrow">¶</a>
</li>
              </ol>
</section>
</div>
<div id="mitigations-4">
<section id="section-8.1.1.6.2">
              <h6 id="name-mitigations-5">
<a href="#section-8.1.1.6.2" class="section-number selfRef">8.1.1.6.2. </a><a href="#name-mitigations-5" class="section-name selfRef">Mitigations</a>
              </h6>
<ol start="1" type="1" class="normal type-1" id="section-8.1.1.6.2-1">
<li id="section-8.1.1.6.2-1.1">All messages exchanged between participants in the system should be
encrypted.<a href="#section-8.1.1.6.2-1.1" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.6.2-1.2">All messages exchanged between aggregators, the collector and the leader
should be mutually authenticated so that network attackers cannot impersonate
participants.<a href="#section-8.1.1.6.2-1.2" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.6.2-1.3">Clients should be required to submit inputs at regular intervals so that the
timing of individual messages does not reveal anything.<a href="#section-8.1.1.6.2-1.3" class="pilcrow">¶</a>
</li>
                <li id="section-8.1.1.6.2-1.4">Clients should submit dummy inputs even for aggregations the user has not
opted into.<a href="#section-8.1.1.6.2-1.4" class="pilcrow">¶</a>
</li>
              </ol>
<p id="section-8.1.1.6.2-2">[[OPEN ISSUE: The threat model for Prio --- as it's described in the original
paper and [BBG+19] --- considers <strong>either</strong> a malicious client (attacking
soundness) <strong>or</strong> a malicious subset of aggregators (attacking privacy). In
particular, soundness isn't guaranteed if any one of the aggregators is
malicious; in theory it may be possible for a malicious client and aggregator to
collude and break soundness. Is this a contingency we need to address? There are
techniques in [BBG+19] that account for this; we need to figure out if they're
practical.]]<a href="#section-8.1.1.6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="future-work-and-possible-extensions">
<section id="section-8.1.2">
          <h4 id="name-future-work-and-possible-ex">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-future-work-and-possible-ex" class="section-name selfRef">Future work and possible extensions</a>
          </h4>
<p id="section-8.1.2-1">In this section we discuss attacks that are not considered in the above threat
model, and suggest mitigations that could be incorporated into implementations
of this protocol or future revisions of this specfication.<a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
<div id="client-authentication">
<section id="section-8.1.2.1">
            <h5 id="name-client-authentication">
<a href="#section-8.1.2.1" class="section-number selfRef">8.1.2.1. </a><a href="#name-client-authentication" class="section-name selfRef">Client authentication</a>
            </h5>
<p id="section-8.1.2.1-1">Attackers can impersonate Prio clients and submit large amounts of false input
in order to spoil aggregations. Deployments could require clients to
authenticate before they may contribute inputs. For example, by requiring
submissions to be signed with a key trusted by aggregators. However some
deployments may opt to accept the risk of false inputs to avoid having to figure
out how to distribute trusted identities to clients.<a href="#section-8.1.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-attestation">
<section id="section-8.1.2.2">
            <h5 id="name-client-attestation">
<a href="#section-8.1.2.2" class="section-number selfRef">8.1.2.2. </a><a href="#name-client-attestation" class="section-name selfRef">Client attestation</a>
            </h5>
<p id="section-8.1.2.2-1">In the current threat model, servers participating in the protocol have no
insight into the activities of clients except that they have uploaded input into
a Prio aggregation, meaning that clients could covertly leak a user's data into
some other channel which compromises privacy. If we introduce the notion of a
trusted computing base which can attest to the properties or activities of a
client, then users and aggregators can be assured that their private data only
goes into Prio. For instance, clients could use the trusted computing base to
attest to software measurements over reproducible builds, or a trusted operating
system could attest to the client's network activity, allowing external
observers to be confident that no data is being exfiltrated.<a href="#section-8.1.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="trusted-anonymizing-and-authenticating-proxy">
<section id="section-8.1.2.3">
            <h5 id="name-trusted-anonymizing-and-aut">
<a href="#section-8.1.2.3" class="section-number selfRef">8.1.2.3. </a><a href="#name-trusted-anonymizing-and-aut" class="section-name selfRef">Trusted anonymizing and authenticating proxy</a>
            </h5>
<p id="section-8.1.2.3-1">While the input shares transmitted by clients to aggregators reveal nothing
about the original input, the aggregator can still learn auxiliary information
received messages (for instance, source IP or HTTP user agent), which can
identify participating clients or permit some attacks on robustness. This is
worse if client authentication used, since incoming messages would be bound to a
cryptographic identity. Deployments could include a trusted anonymizing proxy,
which would be responsible for receiving input shares from clients, stripping
any identifying information from them (including client authentication) and
forwarding them to aggregators. There should still be a confidential and
authenticated channel from the client to the aggregator to ensure that no actor
besides the aggregator may decrypt the input shares.<a href="#section-8.1.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multiple-protocol-runs">
<section id="section-8.1.2.4">
            <h5 id="name-multiple-protocol-runs">
<a href="#section-8.1.2.4" class="section-number selfRef">8.1.2.4. </a><a href="#name-multiple-protocol-runs" class="section-name selfRef">Multiple protocol runs</a>
            </h5>
<p id="section-8.1.2.4-1">Prio is <em>robust</em> against malicious clients, and <em>private</em> against malicious
servers, but cannot provide robustness against malicious servers. Any aggregator
can simply emit bogus output shares and undetectably spoil aggregates. If enough
aggregators were available, this could be mitigated by running the protocol
multiple times with distinct subsets of aggregators chosen so that no aggregator
appears in all subsets and checking all the outputs against each other. If all
the protocol runs do not agree, then participants know that at least one
aggregator is defective, and it may be possible to identify the defector (i.e.,
if a majority of runs agree, and a single aggregator appears in every run that
disagrees). See
<a href="https://github.com/abetterinternet/prio-documents/issues/22">#22</a> for
discussion.<a href="#section-8.1.2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-8.1.3">
          <h4 id="name-security-considerations-2">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security considerations</a>
          </h4>
<div id="infrastructure-diversity">
<section id="section-8.1.3.1">
            <h5 id="name-infrastructure-diversity">
<a href="#section-8.1.3.1" class="section-number selfRef">8.1.3.1. </a><a href="#name-infrastructure-diversity" class="section-name selfRef">Infrastructure diversity</a>
            </h5>
<p id="section-8.1.3.1-1">Prio deployments should ensure that aggregators do not have common dependencies
that would enable a single vendor to reassemble inputs. For example, if all
participating aggregators stored unencrypted input shares on the same cloud
object storage service, then that cloud vendor would be able to reassemble all
the input shares and defeat privacy.<a href="#section-8.1.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="anti-replay">
<section id="section-8.1.3.2">
            <h5 id="name-anti-replay">
<a href="#section-8.1.3.2" class="section-number selfRef">8.1.3.2. </a><a href="#name-anti-replay" class="section-name selfRef">Anti-replay</a>
            </h5>
<p id="section-8.1.3.2-1">Using a report in multiple batches, or multiple times within a single batch, is
considered a privacy violation, since it may leak more information about that
report than intended by the PDA protocol. (For example, this may violate
differential privacy.) To mitigate this issue, the core specification imposes an
ordering on reports so that aggregators can cheaply prevent replays attacks.<a href="#section-8.1.3.2-1" class="pilcrow">¶</a></p>
<p id="section-8.1.3.2-2">Aggregate requests are ordered as follows: We say that a sub-request <code>req2</code>
              <em>follows</em> sub-request <code>req1</code> (both of type <code>PDAAggregateSubReq</code>) if either
<code>req2.time &gt; req1.time</code> or <code>req2.time == req1.time</code> and <code>req2.jitter &gt;
req1.jitter</code>.<a href="#section-8.1.3.2-2" class="pilcrow">¶</a></p>
<p id="section-8.1.3.2-3">To prevent the adversary from tampering with the ordering of reports, honest
clients incorporate the ordering-sensitive parameters <code>(time, jitter)</code> into the
AAD for HPKE encryption.<a href="#section-8.1.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="operational-requirements">
<section id="section-8.2">
        <h3 id="name-system-requirements">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-system-requirements" class="section-name selfRef">System requirements</a>
        </h3>
<div id="data-types">
<section id="section-8.2.1">
          <h4 id="name-data-types">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-data-types" class="section-name selfRef">Data types</a>
        </h4>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">TODO<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="FIPS180-4">[FIPS180-4]</dt>
        <dd>
<span class="refAuthor">Department of Commerce, National Institute of Standards and Technology, U.S.</span>, <span class="refTitle">"NIST FIPS 180-4, Secure Hash Standard"</span>, <time datetime="2012-03" class="refDate">March 2012</time>, <span>&lt;<a href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf">http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.irtf-cfrg-hpke">[I-D.irtf-cfrg-hpke]</dt>
      <dd>
<span class="refAuthor">Barnes, R. L.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-hpke-10</span>, <time datetime="2021-07-07" class="refDate">7 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hpke-10">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hpke-10</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BBCp19">[BBCp19]</dt>
        <dd>
<span class="refTitle">"Zero-Knowledge Proofs on Secret-Shared Data via Fully Linear PCPs"</span>, <time datetime="2021-01-05" class="refDate">5 January 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2019/188">https://eprint.iacr.org/2019/188</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BBCp21">[BBCp21]</dt>
        <dd>
<span class="refTitle">"Lightweight Techniques for Private Heavy Hitters"</span>, <time datetime="2021-01-05" class="refDate">5 January 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2021/017">https://eprint.iacr.org/2021/017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CB17">[CB17]</dt>
      <dd>
<span class="refAuthor">Corrigan-Gibbs, H.</span> and <span class="refAuthor">D. Boneh</span>, <span class="refTitle">"Prio: Private, Robust, and Scalable Computation of Aggregate Statistics"</span>, <time datetime="2017-03-14" class="refDate">14 March 2017</time>, <span>&lt;<a href="https://crypto.stanford.edu/prio/paper.pdf">https://crypto.stanford.edu/prio/paper.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Some People</span></div>
<div dir="auto" class="left"><span class="org">Somewhere</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:over@therainbow.net" class="email">over@therainbow.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
